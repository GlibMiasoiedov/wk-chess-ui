
ТЕХНІЧНЕ ЗАВДАННЯ
WK Chess Learn Module
Інтерактивний модуль навчання шахам
для WordPress-плагіна WK Chess UI

Платформа: whiteknight.academy
Референс: Lichess.org /learn (AGPL v3+)
Дата: 11.02.2026 | Версія: 1.0
 
1. Огляд проєкту
Модуль WK Chess Learn — це інтерактивний покроковий курс навчання шахам для початківців, реалізований як компонент WordPress-плагіна WK Chess UI. Користувач проходить 19 етапів, організованих у 4 категорії, кожен з яких містить інтерактивні завдання на шаховій дошці.
Референсна реалізація: Lichess.org /learn (github.com/lichess-org/lila/tree/master/ui/learn/src). Педагогічна структура використовується як інспірація. Весь код пишеться з нуля для уникнення AGPL-зобов'язань.
1.1 Цілі модуля
Навчити користувача основам шахової гри через інтерактивні завдання на шаховій дошці: рух фігур, взяття, шах, мат, спеціальні правила (рокіровка, en passant), координати дошки. Мова інтерфейсу — українська.
1.2 Технологічний стек
Компонент	Технологія
Бекенд	WordPress PHP (Custom Post Type + REST API)
Фронтенд	React 18 + TypeScript (WK Chess UI компонент)
Шахова дошка	chessground або react-chessboard + chess.js
Валідація ходів	chess.js (legal move validation, FEN parsing)
Зберігання прогресу	localStorage (гость) + WP user_meta (авторизований)
Анімації	CSS transitions + Framer Motion
Звуки	Howler.js (хід, взяття, успіх, помилка)
 
2. Архітектура
2.1 Ієрархія даних
Модуль організований у 3-рівневу ієрархію: Category → Stage → Level. Це повністю відповідає структурі Lichess Learn.
Category (Категорія)
Група етапів, об'єднаних тематично. Всього 4 категорії: Chess Pieces, Fundamentals, Intermediate, Advanced.
Stage (Етап)
Окрема тема з кількома рівнями наростаючої складності. Всього 19 етапів. Кожен етап має назву, опис, іконку, зірки (прогрес).
Level (Рівень)
Конкретне завдання на дошці. Кожен рівень визначається структурою даних:
interface Level {
  fen: string;           // Позиція в FEN-нотації
  color: 'white' | 'black'; // Колір гравця
  goal: GoalType;        // Тип завдання
  targets?: Square[];    // Цільові клітинки (зірочки)
  correctMoves?: string[];// Правильні ходи (UCI)
  obstacles?: Square[];  // Перешкоди на дошці
  hint?: string;         // Підказка (укр. мовою)
  showPieceValues?: boolean;
}
2.2 Структура файлів плагіна
wk-chess-ui/
├── src/
│   ├── learn/
│   │   ├── LearnApp.tsx          // Головний компонент модуля
│   │   ├── LearnMap.tsx          // Карта прогресу (overview)
│   │   ├── StageView.tsx         // Відображення етапу з дошкою
│   │   ├── LevelBoard.tsx        // Шахова дошка + логіка рівня
│   │   ├── StageComplete.tsx     // Екран завершення етапу
│   │   ├── stages/
│   │   │   ├── index.ts             // Реєстр всіх етапів + категорій
│   │   │   ├── rook.ts
│   │   │   ├── bishop.ts
│   │   │   ├── queen.ts
│   │   │   ├── king.ts
│   │   │   ├── knight.ts
│   │   │   ├── pawn.ts
│   │   │   ├── capture.ts
│   │   │   ├── protection.ts
│   │   │   ├── combat.ts
│   │   │   ├── check1.ts ... checkmate2.ts
│   │   │   ├── value.ts
│   │   │   ├── setup.ts
│   │   │   ├── castling.ts
│   │   │   ├── enpassant.ts
│   │   │   ├── stalemate.ts
│   │   │   └── coordinate.ts
│   │   ├── engine/
│   │   │   ├── moveValidator.ts     // Перевірка правильності ходу
│   │   │   ├── goalChecker.ts       // Перевірка досягнення цілі
│   │   │   └── scoring.ts           // Нарахування зірок
│   │   ├── store/
│   │   │   └── progressStore.ts     // Зберігання прогресу
│   │   ├── i18n/
│   │   │   └── uk.ts                // Українські переклади
│   │   └── assets/
│   │       ├── sounds/
│   │       └── images/              // Іконки етапів
 
3. Повна карта етапів (19 stages)
Структура повністю відповідає Lichess Learn. Кількість рівнів у кожному етапі — рекомендований діапазон.
Категорія 1: Шахові фігури (Chess Pieces)
#	Етап	Опис	Рівні	Тип цілі
1	The Rook Тура	Рух тури по горизонталі та вертикалі. Завдання: перемістити фігуру на зірочку	4–6	moveToSquare
2	The Bishop Слон	Рух слона по діагоналях	4–6	moveToSquare
3	The Queen Ферзь	Комбінований рух (тура + слон)	4–6	moveToSquare
4	The King Король	Рух короля на 1 клітинку в будь-якому напрямку	3–5	moveToSquare
5	The Knight Кінь	L-подібний стрибок, перестрибування через фігури	5–8	moveToSquare
6	The Pawn Пішак	Рух вперед, подвійний крок, взяття по діагоналі, перетворення	6–10	moveToSquare, promote
Категорія 2: Основи (Fundamentals)
#	Етап	Опис	Рівні	Тип цілі
7	Capture Взяття	Взяття фігур суперника різними фігурами	5–7	capture
8	Protection Захист	Захист власних фігур від взяття	4–6	protect
9	Combat Бій	Розмін фігур, вигідний розмін	4–6	winMaterial
10	Check in One Шах в 1 хід	Поставити шах королю суперника	5–7	check
11	Out of Check Захист від шаху	Вийти з-під шаху: відійти, заблокувати, збити атакуючу фігуру	4–6	escape
12	Checkmate in One Мат в 1 хід	Поставити мат одним ходом	5–7	checkmate
Категорія 3: Середній рівень (Intermediate)
#	Етап	Опис	Рівні	Тип цілі
13	Piece Value Цінність фігур	Відносна цінність: P=1, N/B=3, R=5, Q=9	4–6	evaluate
14	Checkmate in Two Мат в 2 ходи	Мат у 2 ходи (требує розрахунку)	4–6	checkmate
15	Board Setup Розстановка	Правильне розміщення фігур на дошці	3–5	placePiece
16	Castling Рокіровка	Коротка (O-O) та довга (O-O-O) рокіровка	4–6	castle
17	En Passant Взяття на проході	Спеціальне взяття пішака	3–4	enPassant
18	Stalemate Пат	Нічия через пат — врахування та уникнення	3–5	avoidStalemate
Категорія 4: Просунутий (Advanced)
#	Етап	Опис	Рівні	Тип цілі
19	Coordinates Координати	Знання координат a1–h8	3–5	findSquare
 
4. Типи завдань (GoalType)
Кожен рівень має тип завдання, який визначає логіку перевірки правильності ходу:
GoalType	Опис	Логіка перевірки
moveToSquare	Перемістити фігуру на цільову клітинку (зірочку)	move.to === target
capture	Збити вказану фігуру суперника	chess.isCapture(move)
protect	Захистити свою фігуру від загрози	Перевірка defenders після ходу
check	Поставити шах	chess.inCheck() після ходу
checkmate	Поставити мат	chess.isCheckmate() після ходу
escape	Вийти з-під шаху	!chess.inCheck() після ходу
winMaterial	Виграти матеріал	materialDiff після обміну > 0
castle	Зробити рокіровку	move.san містить O-O
enPassant	Взяття на проході	move.flags містить 'e'
promote	Перетворити пішака	move.flags містить 'p'
evaluate	Обрати фігуру з більшою цінністю	capturedValue > otherOptions
placePiece	Поставити фігуру на правильну клітинку	drag & drop на цільову клітинку
findSquare	Клікнути на названу клітинку	clickedSquare === target
 
5. UI/UX специфікація
5.1 Екран карти прогресу (LearnMap)
Відображає всі 19 етапів у вигляді вертикальної карти з 4 секціями (категоріями). Кожен етап показує:
— Іконку фігури або концепції (SVG); назву українською; зірки прогресу (0–3 за кожен рівень); стан (locked / available / completed). Етапи розблоковуються послідовно: наступний етап доступний після проходження попереднього.
5.2 Екран етапу (StageView)
Складається з трьох основних зон:
Ліва панель: Назва етапу + опис + підказка + прогрес рівнів (кружочки).
Центр: Шахова дошка (респонсивна, макс. 500px). Зірочки як цілі (зелені кола на клітинках). Обстакли як кола на атакованих клітинках (червоні кола).
Права панель: Кнопки: Назад, Підказка, Повторити, Наступний рівень.
5.3 Система зірок
За кожен рівень нараховується 1–3 зірки на основі кількості помилок (неправильних ходів):
3 зірки — 0 помилок (perfect); 2 зірки — 1–2 помилки; 1 зірка — 3+ помилки. Максимальний результат зберігається між сесіями.
5.4 Зворотний зв'язок
Правильний хід: Зелена підсвітка клітинки + звук + анімація збирання зірочки.
Неправильний хід: Червона підсвітка + звук помилки + фігура повертається назад + лічильник помилок++.
Завершення рівня: Анімація зірок + автоперехід на наступний рівень через 1.5с.
Завершення етапу: Екран StageComplete з підсумком зірок + кнопка "Наступний етап".
5.5 Мобільна адаптація
На мобільних пристроях (<768px): дошка займає 100% ширини; ліва/права панелі згортаються під дошку; touch events повністю підтримуються; мінімальний розмір клітинки дошки 44px (для тап-доступності).
 
6. Детальна специфікація етапів
Нижче — приклади FEN-позицій для кожного етапу. Позиції створюються з нуля (не копіюються з Lichess) для уникнення AGPL.
Stage 1: Тура (The Rook)
Мета: Навчити руху тури по горизонталі/вертикалі. Користувач переміщує туру на зірочку (цільову клітинку).
Прогресія: L1 — порожня дошка, 1 зірочка; L2 — 2 зірочки послідовно; L3 — обхід перешкод (obstacles); L4+ — множинні цілі.
Приклад FEN (L1): 8/8/8/8/8/8/8/R7 w - - 0 1 — тура на a1, ціль a8.
Приклад FEN (L3): 8/2p5/8/8/8/8/8/R7 w - - 0 1 — обхід перешкоди на c7.
Stage 5: Кінь (The Knight)
Мета: L-подібний стрибок + перестрибування через фігури. Найскладніший етап у Category 1.
Прогресія: L1 — порожня дошка; L2 — з перешкодами; L3+ — кілька стрибків до цілі; L5+ — зігзаговий маршрут.
Приклад FEN: 8/8/8/8/8/8/8/1N6 w - - 0 1 — кінь на b1.
Stage 6: Пішак (The Pawn)
Мета: Рух вперед, подвійний перший крок, взяття по діагоналі, перетворення.
Прогресія: L1 — просто вперед; L2 — подвійний крок; L3 — взяття; L4+ — змішані; L6+ — перетворення на 8-й горизонталі.
Stage 12: Мат в 1 хід (Checkmate in One)
Мета: Поставити мат одним ходом. Перевірка: chess.isCheckmate() === true після ходу.
Прогресія: L1 — мат турою на останній горизонталі; L2 — мат ферзем; L3 — мат слоном; L4+ — мат конем; L5+ — комбіновані.
Приклад FEN: 6k1/5ppp/8/8/8/8/8/R3K3 w - - 0 1 — Ra1→a8# (back rank mate).
Stage 16: Рокіровка (Castling)
Мета: Навчити короткій (O-O) та довгій (O-O-O) рокіровці. Показати коли не можна (під шахом, через атаковане поле).
Приклад FEN (O-O): r3k2r/pppppppp/8/8/8/8/PPPPPPPP/R3K2R w KQkq - 0 1
Stage 17: Взяття на проході (En Passant)
Мета: Пояснити спеціальне правило: коли пішак суперника робить подвійний крок, можна збити його "на проході".
Приклад FEN: 8/8/8/3pP3/8/8/8/8 w - d6 0 1 — пішак e5 бере d5 на проході (e5xd6).
Stage 19: Координати (Coordinates)
Мета: Навчити швидко знаходити клітинку за назвою (a1–h8). Випадкова клітинка показується на екрані, користувач клікає на неї.
Особливості: Дошка може бути з координатами або без (наростання складності). Таймер можна додати для гейміфікації.
 
7. Модель даних та зберігання
7.1 Структура прогресу
interface LearnProgress {
  stages: {
    [stageKey: string]: {
      levels: {
        [levelIndex: number]: {
          completed: boolean;
          stars: 0 | 1 | 2 | 3;
          attempts: number;
        }
      };
      bestScore: number; // сума зірок
      completed: boolean;
    }
  };
  currentStage: string;
  currentLevel: number;
  totalStars: number;
}
7.2 Зберігання
Гость (неавторизований): localStorage з ключем wk_chess_learn_progress. Дані зберігаються локально.
Авторизований користувач: WP REST API → user_meta таблиця. Синхронізація при авторизації (мердж кращих результатів).
7.3 WP REST API ендпоінти
Method	Endpoint	Опис
GET	/wp-json/wk-chess/v1/learn/progress	Отримати прогрес поточного користувача
POST	/wp-json/wk-chess/v1/learn/progress	Зберегти/оновити прогрес
GET	/wp-json/wk-chess/v1/learn/stages	Отримати конфігурацію всіх етапів
DELETE	/wp-json/wk-chess/v1/learn/progress	Скинути прогрес
 
8. Ігровий цикл (Game Loop)
Основний алгоритм обробки ходу користувача:
1. Користувач робить хід (drag & drop)
2. moveValidator.isLegal(move) — перевірка легальності
   └─ false → повернути фігуру назад (shake анімація)
3. goalChecker.check(move, level) — це правильний хід?
   ├─ true  → анімація успіху, оновити FEN
   └─ false → червона підсвітка, errors++
4. goalChecker.isLevelComplete()
   ├─ true  → нарахувати зірки, зберегти прогрес
   └─ false → продовжити рівень
5. isStageComplete()
   ├─ true  → StageComplete екран
   └─ false → наступний рівень
8.1 Відповідь суперника (opponent moves)
Для етапів з взаємодіюю (combat, checkmate2, outOfCheck): після ходу користувача система автоматично виконує хід суперника (визначений у конфігурації рівня як opponentMoves). Хід анімується з затримкою 500ms.
 
9. Інтеграція з WordPress
9.1 Shortcode
Модуль вбудовується на сторінку через шорткод: [wk_chess_learn] або через Gutenberg-блок. React-додаток монтується в div#wk-chess-learn-root.
9.2 Інтеграція з Tutor LMS
Модуль може бути прив'язаний до курсу Tutor LMS як додатковий тип контенту уроку. Прі завершенні всіх 19 етапів можна оновити статус уроку в Tutor LMS через API.
9.3 Google Analytics 4
Події для відстеження:
Event name	Параметри	Коли
learn_stage_start	stage_key, stage_num	Початок етапу
learn_level_complete	stage_key, level, stars	Завершення рівня
learn_stage_complete	stage_key, total_stars	Завершення етапу
learn_all_complete	total_stars, time_spent	Завершення всіх 19 етапів
learn_hint_used	stage_key, level	Використання підказки
 
10. Залежності та бібліотеки
Бібліотека	Ліцензія	Призначення
chess.js	BSD	Валідація ходів, FEN парсинг, детекція шаху/мату/пату
react-chessboard	MIT	Рендеринг шахової дошки, drag & drop, touch events
Framer Motion	MIT	Анімація UI (зірочки, переходи, shake)
Howler.js	MIT	Звукові ефекти (хід, взяття, успіх)
Zustand	MIT	Стейт-менеджмент прогресу та стану гри
Всі залежності мають ліцензії BSD/MIT, сумісні з комерційним проєктом.
11. Етапи розробки
#	Етап	Термін	Результат
M1	Бойлерплейт + дошка + 1 етап (Rook)	1 тиждень	Працюючий прототип
M2	Category 1 (6 етапів) + карта прогресу	2 тижні	Всі фігури + UI карти
M3	Categories 2–3 (12 етапів)	3 тижні	Основна функціональність
M4	Category 4 + прогрес + WP REST API	2 тижні	Повний модуль
M5	Полішинг + GA4 + Tutor LMS + деплой	1 тиждень	Production-ready

Документ підготовлено на основі аналізу вихідного коду Lichess.org (github.com/lichess-org/lila/tree/master/ui/learn/src). Педагогічна структура — інспірація, код — з нуля. Жодних AGPL-зобов'язань.
